# nixpacks.toml (نسخه نهایی و قطعی - ترکیب Nix Environment و Build-From-Source)

[phases.setup]
# ۱. یک محیط ساخت کامل و یکپارچه با تمام ابزارهای لازم ایجاد می‌کنیم.
# این کار تضمین می‌کند که همه چیز با هم سازگار است.
nixPkgs = ["python311", "gcc", "wget", "tar", "make", "pkg-config"]

# ۲. اسکریپت کامپایل از سورس را درون این محیط یکپارچه اجرا می‌کنیم.
# این کار کتابخانه C را در مسیر استاندارد /usr/ نصب می‌کند.
cmds = [
    "wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz && tar -xzf ta-lib-0.4.0-src.tar.gz && cd ta-lib/ && ./configure --prefix=/usr && make && sudo make install"
]

[start]
# ۳. دستور شروع برنامه را با نسخه پایتون مشخص شده هماهنگ می‌کنیم.
cmd = "python311 -m gunicorn trading_app.wsgi"
